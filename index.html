<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Royalty Splitter</title>
    <link rel="stylesheet" href="style.css" />
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js" defer></script>
    <script src="app.js" type="module" defer></script>
  </head>
  <body class="theme theme--dark">
    <div id="app" class="app" :class="`theme--${theme}`" v-cloak>
      <header class="app__header">
        <div>
          <p class="app__eyebrow">Royalty Manager</p>
          <h1 class="app__title">Royalty Split Calculator</h1>
          <p class="app__subtitle">
            Configure collaborators and visualize precise royalty allocations.
          </p>
        </div>
        <div class="theme-toggle">
          <button
            class="btn btn--ghost"
            type="button"
            @click="toggleTheme"
            :aria-pressed="theme === 'light'"
          >
            <span class="theme-toggle__icon" aria-hidden="true">☀︎</span>
            <span class="theme-toggle__label">
              {{ theme === 'dark' ? 'Light mode' : 'Dark mode' }}
            </span>
          </button>
        </div>
      </header>

      <main class="layout">
        <section class="panel panel--input" aria-labelledby="input-title">
          <div class="panel__header">
            <h2 id="input-title" class="panel__title">Project setup</h2>
            <p class="panel__subtitle">Enter project details and collaborators.</p>
          </div>

          <form class="form" @submit.prevent>
            <label class="form__field">
              <span class="form__label">Project title</span>
              <input
                class="form__control"
                type="text"
                name="projectTitle"
                placeholder="Debut Single: Echoes"
                v-model.trim="projectTitle"
              />
            </label>

            <label class="form__field">
              <span class="form__label">Total royalty amount</span>
              <input
                class="form__control"
                type="number"
                name="totalRoyalty"
                min="0"
                step="0.01"
                placeholder="10000"
                v-model.number="totalRoyalty"
              />
            </label>

            <div class="form__group">
              <div class="form__group-header">
                <h3 class="form__group-title">Collaborators</h3>
                <button
                  class="btn btn--secondary"
                  type="button"
                  @click="addCollaborator"
                >
                  + Add collaborator
                </button>
              </div>

              <ul class="collab-list">
                <li
                  class="collab-list__item"
                  v-for="(collab, index) in collaborators"
                  :key="collab.id"
                >
                  <label class="form__field collab-list__field">
                    <span class="form__label">Name</span>
                    <input
                      class="form__control"
                      type="text"
                      :name="`collaborator-${index}-name`"
                      placeholder="Collaborator name"
                      v-model.trim="collab.name"
                    />
                  </label>

                  <label class="form__field collab-list__field">
                    <span class="form__label">Split (%)</span>
                    <input
                      class="form__control"
                      type="number"
                      :name="`collaborator-${index}-split`"
                      min="0"
                      max="100"
                      step="0.01"
                      placeholder="25"
                      v-model.number="collab.percentage"
                    />
                  </label>

                  <button
                    class="btn btn--ghost collab-list__remove"
                    type="button"
                    @click="removeCollaborator(index)"
                    :aria-label="`Remove ${collab.name || 'collaborator'}`"
                    :disabled="collaborators.length === 1"
                  >
                    ✕
                  </button>
                </li>
              </ul>

              <p
                class="form__helper"
                :class="{
                  'form__helper--error': !isPercentageComplete,
                  'form__helper--success': isPercentageComplete
                }"
                role="status"
              >
                {{ percentageTotal.toFixed(2) }}% allocated /
                {{ isPercentageComplete ? 'Ready to calculate' : 'Must equal 100%' }}
              </p>
            </div>
          </form>
        </section>

        <section class="panel panel--output" aria-labelledby="output-title">
          <div class="panel__header">
            <h2 id="output-title" class="panel__title">Results</h2>
            <p class="panel__subtitle">
              Run the calculation once percentages equal 100%.
            </p>
          </div>

          <div class="panel__actions">
            <button
              class="btn btn--primary"
              type="button"
              @click="calculateSplit"
              :disabled="!canCalculate"
            >
              Calculate split
            </button>
            <button
              class="btn btn--ghost"
              type="button"
              @click="resetForm"
              :disabled="isPristine"
            >
              Reset form
            </button>
          </div>

          <div v-if="results.length" class="results" aria-live="polite">
            <table class="results__table">
              <thead>
                <tr>
                  <th scope="col">Collaborator</th>
                  <th scope="col">Split (%)</th>
                  <th scope="col">Royalty share</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="row in results" :key="row.id">
                  <td>{{ row.name || 'Unnamed collaborator' }}</td>
                  <td>{{ row.percentage.toFixed(2) }}%</td>
                  <td>{{ formatCurrency(row.amount) }}</td>
                </tr>
              </tbody>
              <tfoot>
                <tr>
                  <td>Total</td>
                  <td>100%</td>
                  <td>{{ formatCurrency(totalRoyalty || 0) }}</td>
                </tr>
              </tfoot>
            </table>

            <div class="results__actions">
              <button
                class="btn btn--secondary"
                type="button"
                @click="copyResults"
              >
                Copy results
              </button>
            </div>
            <p v-if="copyMessage" class="results__notice">
              {{ copyMessage }}
            </p>

            <p class="results__summary">
              {{ summaryText }}
            </p>
          </div>
          <p v-else class="results__empty">
            Results will appear here after a successful calculation.
          </p>
        </section>
      </main>
    </div>
  </body>
</html>

